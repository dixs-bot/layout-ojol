<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>OjekX Customer Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      :root {
        --bg: #ffffff;
        --bg-muted: #eef3ff;
        --text-main: #0b0b0f;
        --text-muted: #6b7280;
        --blue: #3b82f6;
        --blue-neon: #60a5fa;
        --card-shadow: 0 10px 30px rgba(15, 23, 42, 0.15);
        --btn-glow: 0 0 15px rgba(96, 165, 250, 0.9),
          0 0 35px rgba(59, 130, 246, 0.65);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Poppins",
          "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #e0f2ff 0, #ffffff 45%, #eef3ff 100%);
        color: var(--text-main);
      }

      .app-root {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .page-header {
        padding: 1rem 1.25rem;
        background: rgba(255, 255, 255, 0.92);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .page-header-title {
        font-size: 1.15rem;
        font-weight: 800;
        letter-spacing: 0.03em;
      }

      .page-header-sub {
        font-size: 0.78rem;
        color: var(--text-muted);
      }

      .logo-dot {
        min-width: 34px;
        min-height: 34px;
        border-radius: 999px;
        border: 2px solid var(--blue-neon);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 0.8rem;
        color: var(--blue-neon);
        box-shadow: 0 0 12px rgba(96, 165, 250, 0.7);
        background: #020617;
      }

      .page-main {
        flex: 1;
        display: flex;
        justify-content: center;
        padding: 1.5rem 1rem;
      }

      .container {
        width: 100%;
        max-width: 480px;
      }

      .card {
        background: radial-gradient(circle at top, #f4f6ff 0, #ffffff 55%);
        border-radius: 20px;
        padding: 1.5rem 1.4rem;
        box-shadow: var(--card-shadow);
        border: 1px solid rgba(226, 232, 240, 0.9);
      }

      .hero-title {
        font-size: 1.9rem;
        font-weight: 900;
        margin-bottom: 0.7rem;
        letter-spacing: 0.02em;
      }

      .hero-highlight {
        background: linear-gradient(to right, #3b82f6, #a855f7);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .hero-sub {
        font-size: 0.92rem;
        color: var(--text-muted);
        line-height: 1.5rem;
        margin-bottom: 1.1rem;
      }

      .hero-actions {
        display: flex;
        flex-direction: column;
        gap: 0.65rem;
      }

      @media (min-width: 480px) {
        .hero-actions {
          flex-direction: row;
        }
      }

      .btn {
        border: none;
        border-radius: 999px;
        padding: 0.7rem 1.1rem;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
        transition: transform 0.15s, box-shadow 0.15s, background-color 0.15s,
          color 0.15s, border-color 0.15s;
        background: transparent;
      }

      .btn-block {
        width: 100%;
      }

      .btn-primary {
        background: #020617;
        color: #f9fafb;
        box-shadow: var(--btn-glow);
        border: 1px solid rgba(148, 163, 184, 0.4);
      }

      .btn-primary:hover {
        box-shadow: 0 0 18px #60a5fa, 0 0 40px #3b82f6;
        transform: translateY(-2px);
      }

      .btn-outline {
        background: transparent;
        color: var(--blue);
        border: 1px solid var(--blue-neon);
        box-shadow: 0 0 10px rgba(191, 219, 254, 0.5);
      }

      .btn-outline:hover {
        background: rgba(15, 23, 42, 0.9);
        color: #e5f0ff;
        box-shadow: var(--btn-glow);
        transform: translateY(-2px);
      }

      .section-title {
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: var(--text-muted);
      }

      label {
        display: block;
        font-size: 0.78rem;
        font-weight: 500;
        color: var(--text-muted);
        margin-bottom: 0.25rem;
      }

      input {
        width: 100%;
        padding: 0.7rem 0.8rem;
        border-radius: 0.7rem;
        border: 1px solid rgba(148, 163, 184, 0.8);
        font-size: 0.9rem;
        outline: none;
        background: rgba(15, 23, 42, 0.02);
        color: var(--text-main);
      }

      input:focus {
        border-color: var(--blue-neon);
        box-shadow: 0 0 0 1px rgba(96, 165, 250, 0.6);
        background: #ffffff;
      }

      .form-group {
        margin-bottom: 0.85rem;
        text-align: left;
      }

      .form-sub {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 1.1rem;
      }

      .small-text {
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      .pill {
        display: inline-block;
        padding: 0.25rem 0.8rem;
        border-radius: 999px;
        font-size: 0.75rem;
        background: rgba(15, 23, 42, 0.9);
        color: #e5f0ff;
        box-shadow: 0 0 10px rgba(37, 99, 235, 0.6);
      }

      footer {
        margin: 0 1rem 1rem;
        font-size: 0.75rem;
        color: var(--text-muted);
        text-align: center;
      }

      .alert {
        padding: 0.6rem 0.8rem;
        border-radius: 0.8rem;
        font-size: 0.8rem;
        margin-bottom: 0.7rem;
      }

      .alert-error {
        background: #fef2f2;
        color: #b91c1c;
        border: 1px solid #fecaca;
      }

      .alert-success {
        background: #ecfdf3;
        color: #166534;
        border: 1px solid #bbf7d0;
      }
    </style>
  </head>
  <body>
    <div id="root">Loading...</div>

    <!-- React & ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useEffect } = React;
      const API_BASE = "http://localhost:3000";

      function CustomerApp() {
        const [screen, setScreen] = useState("landing"); // landing | register | login | dashboard
        const [name, setName] = useState("");
        const [email, setEmail] = useState("");
        const [password, setPassword] = useState("");
        const [token, setToken] = useState(null);
        const [profile, setProfile] = useState(null);
        const [orders, setOrders] = useState([]);
        const [pickup, setPickup] = useState("");
        const [destination, setDestination] = useState("");
        const [serviceType, setServiceType] = useState("bike"); // bike | car | food
        const [loading, setLoading] = useState(false);
        const [message, setMessage] = useState(null);

        useEffect(function () {
          const savedToken = localStorage.getItem("ojekx_customer_token");
          if (savedToken) {
            setToken(savedToken);
            fetchProfile(savedToken);
            fetchOrders(savedToken);
          }
        }, []);

        function showMessage(type, text) {
          setMessage({ type: type, text: text });
          setTimeout(function () {
            setMessage(null);
          }, 2500);
        }

        async function fetchProfile(currentToken) {
          try {
            const usedToken = currentToken || token;
            if (!usedToken) return;
            setLoading(true);
            const res = await fetch(API_BASE + "/profile", {
              headers: { Authorization: "Bearer " + usedToken },
            });
            if (!res.ok) {
              showMessage("error", "Gagal ambil profile. Silakan login ulang.");
              setProfile(null);
              return;
            }
            const data = await res.json();
            setProfile(data);
            setScreen("dashboard");
          } catch (err) {
            showMessage("error", "Error koneksi ke backend (profile).");
          } finally {
            setLoading(false);
          }
        }

        async function fetchOrders(currentToken) {
          try {
            const usedToken = currentToken || token;
            if (!usedToken) return;
            const res = await fetch(API_BASE + "/orders", {
              headers: { Authorization: "Bearer " + usedToken },
            });
            if (!res.ok) {
              console.log("Gagal ambil orders customer");
              return;
            }
            const data = await res.json();
            setOrders(data.orders || []);
          } catch (err) {
            console.log("Error fetch orders customer", err);
          }
        }

        async function handleRegister(e) {
          e.preventDefault();
          setLoading(true);
          setMessage(null);
          try {
            const res = await fetch(API_BASE + "/register", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                name: name,
                email: email,
                password: password,
                role: "customer",
              }),
            });
            const data = await res.json();
            if (!res.ok) {
              showMessage("error", data.message || "Register gagal");
              return;
            }
            showMessage("success", "Register customer berhasil, silakan login.");
            setScreen("login");
          } catch (err) {
            showMessage("error", "Error koneksi ke backend (register).");
          } finally {
            setLoading(false);
          }
        }

        async function handleLogin(e) {
          e.preventDefault();
          setLoading(true);
          setMessage(null);
          try {
            const res = await fetch(API_BASE + "/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email: email, password: password }),
            });
            const data = await res.json();
            if (!res.ok) {
              showMessage("error", data.message || "Login gagal");
              return;
            }
            showMessage("success", "Login customer berhasil.");
            setToken(data.token);
            localStorage.setItem("ojekx_customer_token", data.token);
            fetchProfile(data.token);
            fetchOrders(data.token);
          } catch (err) {
            showMessage("error", "Error koneksi ke backend (login).");
          } finally {
            setLoading(false);
          }
        }

        function handleLogout() {
          setToken(null);
          setProfile(null);
          localStorage.removeItem("ojekx_customer_token");
          setOrders([]);
          setScreen("landing");
          showMessage("success", "Logout customer berhasil.");
        }

        async function handleCreateOrder(e) {
          e.preventDefault();
          if (!pickup || !destination) {
            showMessage("error", "Isi lokasi jemput dan tujuan dulu.");
            return;
          }
          if (!token) {
            showMessage("error", "Harus login sebagai customer.");
            return;
          }

          try {
            setLoading(true);
            const res = await fetch(API_BASE + "/order", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: "Bearer " + token,
              },
              body: JSON.stringify({
                pickup: pickup,
                destination: destination,
                serviceType: serviceType,
              }),
            });
            const data = await res.json();
            if (!res.ok) {
              showMessage("error", data.message || "Gagal membuat order");
              return;
            }
            showMessage(
              "success",
              "Order " + serviceType.toUpperCase() + " berhasil dibuat."
            );
            setPickup("");
            setDestination("");
            fetchOrders(token);
          } catch (err) {
            showMessage("error", "Error koneksi ke backend (order).");
          } finally {
            setLoading(false);
          }
        }

        function renderServiceButton(code, label) {
          const active = serviceType === code;
          const baseClass = "btn " + (active ? "btn-primary" : "btn-outline");
          return (
            <button
              key={code}
              type="button"
              className={baseClass}
              style={{
                padding: "0.35rem 0.8rem",
                fontSize: "0.78rem",
                flex: 1,
              }}
              onClick={function () {
                setServiceType(code);
              }}
            >
              {label}
            </button>
          );
        }

        function renderLanding() {
          return (
            <section className="card">
              {message && (
                <div
                  className={
                    "alert " +
                    (message.type === "error" ? "alert-error" : "alert-success")
                  }
                >
                  {message.text}
                </div>
              )}

              <h1 className="hero-title">
                Panel <span className="hero-highlight">Customer</span>
              </h1>
              <p className="hero-sub">
                Pesan ojol dengan cepat: pilih titik jemput, tujuan, dan jenis layanan
                (Bike, Car, Food). Tampilan bersih dan fokus ke penumpang.
              </p>
              <div className="hero-actions">
                <button
                  className="btn btn-primary btn-block"
                  onClick={function () {
                    setScreen("login");
                  }}
                >
                  Masuk Customer
                </button>
                <button
                  className="btn btn-outline btn-block"
                  onClick={function () {
                    setScreen("register");
                  }}
                >
                  Daftar Customer
                </button>
              </div>
              <div style={{ marginTop: "0.9rem" }}>
                <span className="pill">Mode demo • role: customer</span>
              </div>
            </section>
          );
        }

        function renderRegister() {
          return (
            <section className="card">
              {message && (
                <div
                  className={
                    "alert " +
                    (message.type === "error" ? "alert-error" : "alert-success")
                  }
                >
                  {message.text}
                </div>
              )}

              <h2 className="hero-title" style={{ fontSize: "1.5rem" }}>
                Daftar <span className="hero-highlight">Customer</span>
              </h2>
              <p className="form-sub">
                Buat akun penumpang. Data disimpan di{" "}
                <code>users.json</code> dengan role <b>customer</b>.
              </p>
              <form onSubmit={handleRegister}>
                <div className="form-group">
                  <label>Nama Lengkap</label>
                  <input
                    value={name}
                    onChange={function (e) {
                      setName(e.target.value);
                    }}
                    placeholder="contoh: Rani Putri"
                  />
                </div>
                <div className="form-group">
                  <label>Email</label>
                  <input
                    value={email}
                    onChange={function (e) {
                      setEmail(e.target.value);
                    }}
                    placeholder="customer1@test.com"
                  />
                </div>
                <div className="form-group">
                  <label>Password</label>
                  <input
                    type="password"
                    value={password}
                    onChange={function (e) {
                      setPassword(e.target.value);
                    }}
                    placeholder="minimal 6 karakter"
                  />
                </div>
                <button
                  className="btn btn-primary btn-block"
                  type="submit"
                  disabled={loading}
                >
                  {loading ? "Mendaftar..." : "Daftar Customer"}
                </button>
              </form>
              <p className="small-text" style={{ marginTop: "0.8rem" }}>
                Sudah punya akun?{" "}
                <a
                  href="#"
                  onClick={function (e) {
                    e.preventDefault();
                    setScreen("login");
                  }}
                >
                  Masuk di sini
                </a>
              </p>
            </section>
          );
        }

        function renderLogin() {
          return (
            <section className="card">
              {message && (
                <div
                  className={
                    "alert " +
                    (message.type === "error" ? "alert-error" : "alert-success")
                  }
                >
                  {message.text}
                </div>
              )}

              <h2 className="hero-title" style={{ fontSize: "1.5rem" }}>
                Masuk <span className="hero-highlight">Customer</span>
              </h2>
              <p className="form-sub">
                Gunakan email & password yang sudah kamu daftarkan sebagai customer.
              </p>
              <form onSubmit={handleLogin}>
                <div className="form-group">
                  <label>Email</label>
                  <input
                    value={email}
                    onChange={function (e) {
                      setEmail(e.target.value);
                    }}
                    placeholder="customer1@test.com"
                  />
                </div>
                <div className="form-group">
                  <label>Password</label>
                  <input
                    type="password"
                    value={password}
                    onChange={function (e) {
                      setPassword(e.target.value);
                    }}
                    placeholder="••••••••"
                  />
                </div>
                <button
                  className="btn btn-primary btn-block"
                  type="submit"
                  disabled={loading}
                >
                  {loading ? "Masuk..." : "Masuk"}
                </button>
              </form>
              <p className="small-text" style={{ marginTop: "0.8rem" }}>
                Belum punya akun?{" "}
                <a
                  href="#"
                  onClick={function (e) {
                    e.preventDefault();
                    setScreen("register");
                  }}
                >
                  Daftar customer dulu
                </a>
              </p>
            </section>
          );
        }

        function renderDashboard() {
          return (
            <section className="card">
              {message && (
                <div
                  className={
                    "alert " +
                    (message.type === "error" ? "alert-error" : "alert-success")
                  }
                >
                  {message.text}
                </div>
              )}

              <h2 className="hero-title" style={{ fontSize: "1.5rem" }}>
                Halo,{" "}
                <span className="hero-highlight">
                  {profile ? profile.name : "Customer"}
                </span>
              </h2>
              <p className="form-sub">
                Pesan perjalananmu: tentukan titik jemput, tujuan, dan jenis layanan.
                Order disimpan di <code>orders.json</code> dan hanya milikmu.
              </p>

              {/* PILIH LAYANAN */}
              <div style={{ marginBottom: "0.9rem" }}>
                <div className="section-title">Jenis layanan</div>
                <div
                  style={{
                    display: "flex",
                    gap: "0.4rem",
                    marginTop: "0.4rem",
                  }}
                >
                  {renderServiceButton("bike", "Bike")}
                  {renderServiceButton("car", "Car")}
                  {renderServiceButton("food", "Food")}
                </div>
                <p className="small-text" style={{ marginTop: "0.4rem" }}>
                  • Bike: motor cepat & hemat. <br />
                  • Car: lebih nyaman dan lega. <br />
                  • Food: pesan makan antar ke lokasi kamu.
                </p>
              </div>

              {/* FORM ORDER */}
              <div style={{ marginBottom: "0.9rem" }}>
                <div className="section-title">Buat order perjalanan</div>
                <form onSubmit={handleCreateOrder}>
                  <div className="form-group">
                    <label>Lokasi jemput</label>
                    <input
                      value={pickup}
                      onChange={function (e) {
                        setPickup(e.target.value);
                      }}
                      placeholder="contoh: Rumah / Jalan Sudirman"
                    />
                  </div>
                  <div className="form-group">
                    <label>Tujuan</label>
                    <input
                      value={destination}
                      onChange={function (e) {
                        setDestination(e.target.value);
                      }}
                      placeholder="contoh: Kantor / Mall / Restoran"
                    />
                  </div>
                  <button
                    className="btn btn-primary btn-block"
                    type="submit"
                    disabled={loading}
                  >
                    {loading ? "Memproses..." : "Pesan Sekarang"}
                  </button>
                </form>
              </div>

              {/* LIST ORDER */}
              <div style={{ marginBottom: "0.9rem" }}>
                <div className="section-title">Riwayat order kamu</div>
                {orders.length === 0 ? (
                  <p className="small-text">
                    Belum ada order. Coba buat satu perjalanan dulu.
                  </p>
                ) : (
                  <div
                    style={{
                      maxHeight: "200px",
                      overflowY: "auto",
                      borderRadius: "12px",
                      border: "1px solid rgba(148,163,184,0.5)",
                      padding: "0.5rem",
                      background: "rgba(255,255,255,0.6)",
                    }}
                  >
                    {orders
                      .slice()
                      .reverse()
                      .map(function (order) {
                        const jenis =
                          order.serviceType ||
                          (order.pickup && order.destination ? "bike" : "-");
                        return (
                          <div
                            key={order.id}
                            style={{
                              padding: "0.55rem 0.6rem",
                              borderRadius: "10px",
                              marginBottom: "0.4rem",
                              background: "rgba(15,23,42,0.9)",
                              color: "#e5e7eb",
                              fontSize: "0.8rem",
                              border: "1px solid rgba(75,85,99,0.7)",
                            }}
                          >
                            <div style={{ fontWeight: 600 }}>
                              [{jenis.toUpperCase()}] {order.pickup} →{" "}
                              {order.destination}
                            </div>
                            <div
                              style={{
                                fontSize: "0.72rem",
                                color: "#9ca3af",
                                marginTop: "0.1rem",
                              }}
                            >
                              Status: {order.status} •{" "}
                              {new Date(order.createdAt).toLocaleString("id-ID", {
                                day: "2-digit",
                                month: "short",
                                hour: "2-digit",
                                minute: "2-digit",
                              })}
                            </div>
                          </div>
                        );
                      })}
                  </div>
                )}
              </div>

              {/* PROFIL CUSTOMER */}
              <div style={{ marginBottom: "0.9rem" }}>
                <div className="section-title">Profil Customer</div>
                <p className="small-text">
                  Nama: <b>{profile ? profile.name : "-"}</b>
                  <br />
                  Email: <b>{profile ? profile.email : "-"}</b>
                  <br />
                  Role: <b>{profile ? profile.role : "-"}</b>
                </p>
              </div>

              <button className="btn btn-outline btn-block" onClick={handleLogout}>
                Logout
              </button>
            </section>
          );
        }

        if (screen === "landing") return renderLanding();
        if (screen === "register") return renderRegister();
        if (screen === "login") return renderLogin();
        return renderDashboard();
      }

      function AppShell() {
        return (
          <div className="app-root">
            <header className="page-header">
              <div style={{ flex: 1 }}>
                <div className="page-header-title">OjekX Customer</div>
                <div className="page-header-sub">
                  Panel pemesanan untuk penumpang (Bike / Car / Food)
                </div>
              </div>
              <div className="logo-dot">CX</div>
            </header>

            <main className="page-main">
              <div className="container">
                <CustomerApp />
              </div>
            </main>

            <footer>© 2025 OjekX • Customer Panel</footer>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<AppShell />);
    </script>
  </body>
</html>
