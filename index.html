<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>OjekX Driver Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      :root {
        --bg: #ffffff;
        --bg-muted: #eef3ff;
        --text-main: #0b0b0f;
        --text-muted: #6b7280;
        --blue: #3b82f6;
        --blue-neon: #60a5fa;
        --card-shadow: 0 10px 30px rgba(15, 23, 42, 0.15);
        --btn-glow: 0 0 15px rgba(96, 165, 250, 0.9),
          0 0 35px rgba(59, 130, 246, 0.65);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Poppins",
          "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #e0f2ff 0, #ffffff 45%, #eef3ff 100%);
        color: var(--text-main);
      }

      .app-root {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      .page-header {
        padding: 1rem 1.25rem;
        background: rgba(255, 255, 255, 0.92);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .page-header-title {
        font-size: 1.15rem;
        font-weight: 800;
        letter-spacing: 0.03em;
      }

      .page-header-sub {
        font-size: 0.78rem;
        color: var(--text-muted);
      }

      .logo-dot {
        min-width: 34px;
        min-height: 34px;
        border-radius: 999px;
        border: 2px solid var(--blue-neon);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 0.8rem;
        color: var(--blue-neon);
        box-shadow: 0 0 12px rgba(96, 165, 250, 0.7);
        background: #020617;
      }

      .page-main {
        flex: 1;
        display: flex;
        justify-content: center;
        padding: 1.5rem 1rem;
      }

      .container {
        width: 100%;
        max-width: 480px;
      }

      .card {
        background: radial-gradient(circle at top, #f4f6ff 0, #ffffff 55%);
        border-radius: 20px;
        padding: 1.5rem 1.4rem;
        box-shadow: var(--card-shadow);
        border: 1px solid rgba(226, 232, 240, 0.9);
      }

      .hero-title {
        font-size: 1.9rem;
        font-weight: 900;
        margin-bottom: 0.4rem;
        letter-spacing: 0.02em;
      }

      .hero-highlight {
        background: linear-gradient(to right, #3b82f6, #a855f7);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .hero-sub {
        font-size: 0.9rem;
        color: var(--text-muted);
        line-height: 1.4rem;
        margin-bottom: 0.8rem;
      }

      .hero-actions {
        display: flex;
        flex-direction: column;
        gap: 0.65rem;
      }

      @media (min-width: 480px) {
        .hero-actions {
          flex-direction: row;
        }
      }

      .btn {
        border: none;
        border-radius: 999px;
        padding: 0.7rem 1.1rem;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
        transition: transform 0.15s, box-shadow 0.15s, background-color 0.15s,
          color 0.15s, border-color 0.15s;
        background: transparent;
      }

      .btn-block {
        width: 100%;
      }

      .btn-primary {
        background: #020617;
        color: #f9fafb;
        box-shadow: var(--btn-glow);
        border: 1px solid rgba(148, 163, 184, 0.4);
      }

      .btn-primary:hover {
        box-shadow: 0 0 18px #60a5fa, 0 0 40px #3b82f6;
        transform: translateY(-2px);
      }

      .btn-outline {
        background: transparent;
        color: var(--blue);
        border: 1px solid var(--blue-neon);
        box-shadow: 0 0 10px rgba(191, 219, 254, 0.5);
      }

      .btn-outline:hover {
        background: rgba(15, 23, 42, 0.9);
        color: #e5f0ff;
        box-shadow: var(--btn-glow);
        transform: translateY(-2px);
      }

      .section-title {
        font-size: 0.78rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: var(--text-muted);
      }

      label {
        display: block;
        font-size: 0.78rem;
        font-weight: 500;
        color: var(--text-muted);
        margin-bottom: 0.25rem;
      }

      input {
        width: 100%;
        padding: 0.7rem 0.8rem;
        border-radius: 0.7rem;
        border: 1px solid rgba(148, 163, 184, 0.8);
        font-size: 0.9rem;
        outline: none;
        background: rgba(15, 23, 42, 0.02);
        color: var(--text-main);
      }

      input:focus {
        border-color: var(--blue-neon);
        box-shadow: 0 0 0 1px rgba(96, 165, 250, 0.6);
        background: #ffffff;
      }

      .form-group {
        margin-bottom: 0.85rem;
        text-align: left;
      }

      .form-sub {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 1.1rem;
      }

      .small-text {
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      .pill {
        display: inline-block;
        padding: 0.25rem 0.8rem;
        border-radius: 999px;
        font-size: 0.75rem;
        background: rgba(15, 23, 42, 0.9);
        color: #e5f0ff;
        box-shadow: 0 0 10px rgba(37, 99, 235, 0.6);
      }

      footer {
        margin: 0 1rem 1rem;
        font-size: 0.75rem;
        color: var(--text-muted);
        text-align: center;
      }

      .alert {
        padding: 0.6rem 0.8rem;
        border-radius: 0.8rem;
        font-size: 0.8rem;
        margin-bottom: 0.7rem;
      }

      .alert-error {
        background: #fef2f2;
        color: #b91c1c;
        border: 1px solid #fecaca;
      }

      .alert-success {
        background: #ecfdf3;
        color: #166534;
        border: 1px solid #bbf7d0;
      }

      /* Avatar / foto driver di kanan atas */
      .avatar-wrapper {
        width: 56px;
        height: 56px;
        border-radius: 999px;
        border: 2px solid var(--blue-neon);
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #020617;
        box-shadow: 0 0 12px rgba(96, 165, 250, 0.7);
      }

      .avatar-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .avatar-placeholder {
        color: #e5e7eb;
        font-weight: 700;
        font-size: 0.85rem;
      }

      /* Hamburger menu */
      .hamburger-btn {
        width: 34px;
        height: 34px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.9);
        background: rgba(15, 23, 42, 0.96);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 0 12px rgba(15, 23, 42, 0.55);
      }

      .hamburger-lines {
        width: 16px;
        height: 2px;
        border-radius: 999px;
        background: #e5e7eb;
        position: relative;
      }

      .hamburger-lines::before,
      .hamburger-lines::after {
        content: "";
        position: absolute;
        left: 0;
        width: 16px;
        height: 2px;
        border-radius: 999px;
        background: #e5e7eb;
      }

      .hamburger-lines::before {
        top: -5px;
      }

      .hamburger-lines::after {
        top: 5px;
      }

      .menu-panel {
        position: absolute;
        top: 52px;
        right: 1.6rem;
        width: 180px;
        background: rgba(15, 23, 42, 0.98);
        color: #e5e7eb;
        border-radius: 16px;
        border: 1px solid rgba(148, 163, 184, 0.8);
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
        padding: 0.5rem 0.5rem 0.35rem;
        z-index: 20;
      }

      .menu-item {
        width: 100%;
        padding: 0.4rem 0.6rem;
        border-radius: 999px;
        border: none;
        background: transparent;
        color: inherit;
        font-size: 0.8rem;
        text-align: left;
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
      }

      .menu-item span {
        opacity: 0.9;
      }

      .menu-item:hover {
        background: rgba(31, 41, 55, 0.95);
      }

      .menu-item-label {
        font-size: 0.7rem;
        color: #9ca3af;
        padding: 0.2rem 0.2rem 0.1rem;
      }

      /* Progress target */
      .progress-bar {
        width: 100%;
        height: 8px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.4);
        overflow: hidden;
        margin-top: 0.25rem;
      }

      .progress-fill {
        height: 100%;
        border-radius: 999px;
        background: linear-gradient(to right, #3b82f6, #22c55e);
      }

      .progress-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 0.15rem;
      }

      /* Quick nav row */
      .quick-nav {
        display: flex;
        gap: 0.4rem;
        margin-bottom: 0.8rem;
        flex-wrap: wrap;
      }

      .quick-nav-btn {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.8);
        background: rgba(255, 255, 255, 0.9);
        font-size: 0.75rem;
        padding: 0.4rem 0.7rem;
        cursor: pointer;
      }

      .quick-nav-btn.active {
        background: #020617;
        color: #e5e7eb;
        border-color: var(--blue-neon);
        box-shadow: 0 0 12px rgba(59, 130, 246, 0.8);
      }
    </style>
  </head>
  <body>
    <div id="root">Loading...</div>

    <!-- React & ReactDOM dari CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useEffect } = React;
      const API_BASE = "http://localhost:3000"; // ganti ke IP kalau pakai 2 HP

      function formatRupiah(n) {
        if (!n || isNaN(n)) return "Rp 0";
        return "Rp " + Number(n).toLocaleString("id-ID");
      }

      function scrollToSection(id) {
        const el = document.getElementById(id);
        if (el) {
          el.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }

      function DriverApp() {
        const [screen, setScreen] = useState("landing"); // landing | register | login | dashboard
        const [name, setName] = useState("");
        const [email, setEmail] = useState("");
        const [password, setPassword] = useState("");
        const [token, setToken] = useState(null);
        const [profile, setProfile] = useState(null);
        const [loading, setLoading] = useState(false);
        const [message, setMessage] = useState(null);
        const [isOnline, setIsOnline] = useState(false);

        const [openOrders, setOpenOrders] = useState([]);
        const [myOrders, setMyOrders] = useState([]);

        // target & foto
        const [targetIncome, setTargetIncome] = useState(200000);
        const [targetInput, setTargetInput] = useState("200000");
        const [photoUrl, setPhotoUrl] = useState("");
        const [photoInput, setPhotoInput] = useState("");

        // menu & nav
        const [menuOpen, setMenuOpen] = useState(false);
        const [activeNav, setActiveNav] = useState("dashboard"); // dashboard | income | orders | profile

        useEffect(function () {
          const savedToken = localStorage.getItem("ojekx_token");
          if (savedToken) {
            setToken(savedToken);
            fetchProfile(savedToken);
            fetchMyOrders(savedToken);
            fetchOpenOrders(savedToken);
          }
          const savedStatus = localStorage.getItem("ojekx_driver_status");
          if (savedStatus === "online") {
            setIsOnline(true);
          }

          const savedTarget = localStorage.getItem("ojekx_target_income");
          if (savedTarget) {
            const num = Number(savedTarget);
            if (!isNaN(num) && num > 0) {
              setTargetIncome(num);
              setTargetInput(String(num));
            }
          }

          const savedPhoto = localStorage.getItem("ojekx_driver_photo");
          if (savedPhoto) {
            setPhotoUrl(savedPhoto);
            setPhotoInput(savedPhoto);
          }
        }, []);

        function showMessage(type, text) {
          setMessage({ type: type, text: text });
          setTimeout(function () {
            setMessage(null);
          }, 2500);
        }

        async function fetchProfile(currentToken) {
          try {
            const usedToken = currentToken || token;
            if (!usedToken) return;
            setLoading(true);
            const res = await fetch(API_BASE + "/profile", {
              headers: { Authorization: "Bearer " + usedToken },
            });
            if (!res.ok) {
              showMessage("error", "Gagal ambil profile. Coba login ulang.");
              setProfile(null);
              return;
            }
            const data = await res.json();
            setProfile(data);
            setScreen("dashboard");
          } catch (err) {
            showMessage("error", "Error koneksi ke backend.");
          } finally {
            setLoading(false);
          }
        }

        async function fetchMyOrders(currentToken) {
          try {
            const usedToken = currentToken || token;
            if (!usedToken) return;
            const res = await fetch(API_BASE + "/orders", {
              headers: { Authorization: "Bearer " + usedToken },
            });
            if (!res.ok) {
              console.log("Gagal ambil orders driver");
              return;
            }
            const data = await res.json();
            setMyOrders(data.orders || []);
          } catch (err) {
            console.log("Error fetchMyOrders", err);
          }
        }

        async function fetchOpenOrders(currentToken) {
          try {
            const usedToken = currentToken || token;
            if (!usedToken) return;
            const res = await fetch(API_BASE + "/orders/open", {
              headers: { Authorization: "Bearer " + usedToken },
            });
            if (!res.ok) {
              console.log("Gagal ambil orders open");
              return;
            }
            const data = await res.json();
            setOpenOrders(data.orders || []);
          } catch (err) {
            console.log("Error fetchOpenOrders", err);
          }
        }

        async function handleRegister(e) {
          e.preventDefault();
          setLoading(true);
          setMessage(null);
          try {
            const res = await fetch(API_BASE + "/register", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                name: name,
                email: email,
                password: password,
                role: "driver",
              }),
            });
            const data = await res.json();
            if (!res.ok) {
              showMessage("error", data.message || "Register gagal");
              return;
            }
            showMessage("success", "Register driver berhasil, silakan login.");
            setScreen("login");
          } catch (err) {
            showMessage("error", "Error koneksi ke backend.");
          } finally {
            setLoading(false);
          }
        }

        async function handleLogin(e) {
          e.preventDefault();
          setLoading(true);
          setMessage(null);
          try {
            const res = await fetch(API_BASE + "/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email: email, password: password }),
            });
            const data = await res.json();
            if (!res.ok) {
              showMessage("error", data.message || "Login gagal");
              return;
            }
            showMessage("success", "Login driver berhasil.");
            setToken(data.token);
            localStorage.setItem("ojekx_token", data.token);
            fetchProfile(data.token);
            fetchMyOrders(data.token);
            fetchOpenOrders(data.token);
          } catch (err) {
            showMessage("error", "Error koneksi ke backend.");
          } finally {
            setLoading(false);
          }
        }

        function handleLogout() {
          setToken(null);
          setProfile(null);
          localStorage.removeItem("ojekx_token");
          setScreen("landing");
          setIsOnline(false);
          localStorage.setItem("ojekx_driver_status", "offline");
          setMyOrders([]);
          setOpenOrders([]);
          showMessage("success", "Logout driver berhasil.");
        }

        function toggleOnlineStatus() {
          const next = !isOnline;
          setIsOnline(next);
          localStorage.setItem("ojekx_driver_status", next ? "online" : "offline");
          showMessage(
            "success",
            next
              ? "Status driver: ONLINE (siap terima order)"
              : "Status driver: OFFLINE (tidak terima order)"
          );
        }

        async function handleAcceptOrder(orderId) {
          if (!token) {
            showMessage("error", "Harus login sebagai driver.");
            return;
          }
          try {
            setLoading(true);
            const res = await fetch(API_BASE + "/orders/accept", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: "Bearer " + token,
              },
              body: JSON.stringify({ orderId: orderId }),
            });
            const data = await res.json();
            if (!res.ok) {
              showMessage("error", data.message || "Gagal ambil order");
              return;
            }
            showMessage("success", "Order berhasil diambil.");
            fetchMyOrders(token);
            fetchOpenOrders(token);
          } catch (err) {
            showMessage("error", "Error koneksi saat ambil order.");
          } finally {
            setLoading(false);
          }
        }

        function handleSaveTarget(e) {
          e.preventDefault();
          const num = Number(targetInput);
          if (isNaN(num) || num <= 0) {
            showMessage("error", "Target harus berupa angka lebih dari 0.");
            return;
          }
          setTargetIncome(num);
          localStorage.setItem("ojekx_target_income", String(num));
          showMessage("success", "Target pendapatan disimpan.");
        }

        function handleSavePhoto(e) {
          e.preventDefault();
          if (!photoInput || !photoInput.trim()) {
            setPhotoUrl("");
            localStorage.removeItem("ojekx_driver_photo");
            showMessage("success", "Foto dihapus.");
            return;
          }
          setPhotoUrl(photoInput.trim());
          localStorage.setItem("ojekx_driver_photo", photoInput.trim());
          showMessage("success", "URL foto driver disimpan.");
        }

        // Hitung pendapatan
        const totalIncome = myOrders.reduce(function (sum, order) {
          return sum + Number(order.feeDriver || 0);
        }, 0);

        const progress =
          targetIncome > 0
            ? Math.max(
                0,
                Math.min(100, Math.round((totalIncome / targetIncome) * 100))
              )
            : 0;

        const bonusActive = totalIncome >= targetIncome;
        const bonusEstimate = Math.round(totalIncome * 0.1); // contoh bonus 10%

        function handleNavClick(key, sectionId) {
          setActiveNav(key);
          scrollToSection(sectionId);
          setMenuOpen(false);
        }

        function renderLanding() {
          return (
            <section className="card">
              {message && (
                <div
                  className={
                    "alert " +
                    (message.type === "error" ? "alert-error" : "alert-success")
                  }
                >
                  {message.text}
                </div>
              )}

              <h1 className="hero-title">
                Dashboard <span className="hero-highlight">Driver</span>
              </h1>
              <p className="hero-sub">
                Kelola status kerja, lihat order dari customer, dan ambil perjalanan
                langsung dari panel ini.
              </p>
              <div className="hero-actions">
                <button
                  className="btn btn-primary btn-block"
                  onClick={function () {
                    setScreen("login");
                  }}
                >
                  Masuk Driver
                </button>
                <button
                  className="btn btn-outline btn-block"
                  onClick={function () {
                    setScreen("register");
                  }}
                >
                  Daftar Driver
                </button>
              </div>
              <div style={{ marginTop: "0.9rem" }}>
                <span className="pill">
                  Mode demo â€¢ driver terhubung ke order customer
                </span>
              </div>
            </section>
          );
        }

        function renderRegister() {
          return (
            <section className="card">
              {message && (
                <div
                  className={
                    "alert " +
                    (message.type === "error" ? "alert-error" : "alert-success")
                  }
                >
                  {message.text}
                </div>
              )}

              <h2 className="hero-title" style={{ fontSize: "1.5rem" }}>
                Daftar <span className="hero-highlight">Driver</span>
              </h2>
              <p className="form-sub">
                Isi data sederhana di bawah ini. Akun driver akan tersimpan di{" "}
                <code>users.json</code> dengan role <b>driver</b>.
              </p>
              <form onSubmit={handleRegister}>
                <div className="form-group">
                  <label>Nama Lengkap</label>
                  <input
                    value={name}
                    onChange={function (e) {
                      setName(e.target.value);
                    }}
                    placeholder="contoh: Dika Pratama"
                  />
                </div>
                <div className="form-group">
                  <label>Email</label>
                  <input
                    value={email}
                    onChange={function (e) {
                      setEmail(e.target.value);
                    }}
                    placeholder="driver1@test.com"
                  />
                </div>
                <div className="form-group">
                  <label>Password</label>
                  <input
                    type="password"
                    value={password}
                    onChange={function (e) {
                      setPassword(e.target.value);
                    }}
                    placeholder="minimal 6 karakter"
                  />
                </div>
                <button
                  className="btn btn-primary btn-block"
                  type="submit"
                  disabled={loading}
                >
                  {loading ? "Mendaftar..." : "Daftar Driver"}
                </button>
              </form>
              <p className="small-text" style={{ marginTop: "0.8rem" }}>
                Sudah punya akun?{" "}
                <a
                  href="#"
                  onClick={function (e) {
                    e.preventDefault();
                    setScreen("login");
                  }}
                >
                  Masuk di sini
                </a>
              </p>
            </section>
          );
        }

        function renderLogin() {
          return (
            <section className="card">
              {message && (
                <div
                  className={
                    "alert " +
                    (message.type === "error" ? "alert-error" : "alert-success")
                  }
                >
                  {message.text}
                </div>
              )}

              <h2 className="hero-title" style={{ fontSize: "1.5rem" }}>
                Masuk <span className="hero-highlight">Driver</span>
              </h2>
              <p className="form-sub">
                Login untuk melihat order customer dan ambil perjalanan.
              </p>
              <form onSubmit={handleLogin}>
                <div className="form-group">
                  <label>Email</label>
                  <input
                    value={email}
                    onChange={function (e) {
                      setEmail(e.target.value);
                    }}
                    placeholder="driver1@test.com"
                  />
                </div>
                <div className="form-group">
                  <label>Password</label>
                  <input
                    type="password"
                    value={password}
                    onChange={function (e) {
                      setPassword(e.target.value);
                    }}
                    placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  />
                </div>
                <button
                  className="btn btn-primary btn-block"
                  type="submit"
                  disabled={loading}
                >
                  {loading ? "Masuk..." : "Masuk"}
                </button>
              </form>
              <p className="small-text" style={{ marginTop: "0.8rem" }}>
                Belum punya akun?{" "}
                <a
                  href="#"
                  onClick={function (e) {
                    e.preventDefault();
                    setScreen("register");
                  }}
                >
                  Daftar driver dulu
                </a>
              </p>
            </section>
          );
        }

        function renderDashboard() {
          const statusLabel = isOnline ? "ONLINE" : "OFFLINE";
          const statusColor = isOnline ? "#22c55e" : "#f97316";
          const statusBg = isOnline ? "rgba(34,197,94,0.15)" : "rgba(248,113,113,0.15)";

          return (
            <section className="card" style={{ position: "relative" }}>
              {message && (
                <div
                  className={
                    "alert " +
                    (message.type === "error" ? "alert-error" : "alert-success")
                  }
                >
                  {message.text}
                </div>
              )}

              {/* TOP ROW: title + photo + hamburger */}
              <div
                style={{
                  display: "flex",
                  justifyContent: "space-between",
                  alignItems: "flex-start",
                  gap: "0.8rem",
                  marginBottom: "0.4rem",
                }}
              >
                <div style={{ flex: 1, minWidth: "0" }}>
                  <h2 className="hero-title" style={{ fontSize: "1.6rem" }}>
                    Halo,{" "}
                    <span className="hero-highlight">
                      {profile ? profile.name : "Driver"}
                    </span>
                  </h2>
                  <p className="hero-sub" style={{ marginBottom: 0 }}>
                    Pantau pendapatan, ambil order, dan kelola profil dari satu
                    tempat.
                  </p>
                </div>

                <div
                  style={{
                    display: "flex",
                    flexDirection: "column",
                    alignItems: "flex-end",
                    gap: "0.4rem",
                  }}
                >
                  {/* Foto di kanan atas */}
                  <div className="avatar-wrapper">
                    {photoUrl ? (
                      <img src={photoUrl} alt="Foto driver" className="avatar-img" />
                    ) : (
                      <div className="avatar-placeholder">
                        {profile && profile.name
                          ? profile.name
                              .split(" ")
                              .slice(0, 2)
                              .map((n) => n[0]?.toUpperCase())
                              .join("")
                          : "DX"}
                      </div>
                    )}
                  </div>

                  {/* Tombol garis 3 */}
                  <button
                    type="button"
                    className="hamburger-btn"
                    onClick={function () {
                      setMenuOpen(!menuOpen);
                    }}
                  >
                    <div className="hamburger-lines"></div>
                  </button>
                </div>
              </div>

              {/* Panel menu dropdown */}
              {menuOpen && (
                <div className="menu-panel">
                  <div className="menu-item-label">Menu fitur</div>
                  <button
                    className="menu-item"
                    type="button"
                    onClick={function () {
                      handleNavClick("dashboard", "section-status");
                    }}
                  >
                    <span>Dashboard</span>
                    <span>â€¢</span>
                  </button>
                  <button
                    className="menu-item"
                    type="button"
                    onClick={function () {
                      handleNavClick("income", "section-income");
                    }}
                  >
                    <span>Pendapatan</span>
                    <span>Rp</span>
                  </button>
                  <button
                    className="menu-item"
                    type="button"
                    onClick={function () {
                      handleNavClick("orders", "section-orders");
                    }}
                  >
                    <span>Order</span>
                    <span>ðŸ›µ</span>
                  </button>
                  <button
                    className="menu-item"
                    type="button"
                    onClick={function () {
                      handleNavClick("profile", "section-profile");
                    }}
                  >
                    <span>Profil</span>
                    <span>ðŸ‘¤</span>
                  </button>
                  <div className="menu-item-label">Slot fitur lain (coming soon)</div>
                </div>
              )}

              {/* QUICK NAV BUTTONS */}
              <div className="quick-nav">
                <button
                  type="button"
                  className={
                    "quick-nav-btn " + (activeNav === "dashboard" ? "active" : "")
                  }
                  onClick={function () {
                    handleNavClick("dashboard", "section-status");
                  }}
                >
                  Dashboard
                </button>
                <button
                  type="button"
                  className={
                    "quick-nav-btn " + (activeNav === "income" ? "active" : "")
                  }
                  onClick={function () {
                    handleNavClick("income", "section-income");
                  }}
                >
                  Pendapatan
                </button>
                <button
                  type="button"
                  className={
                    "quick-nav-btn " + (activeNav === "orders" ? "active" : "")
                  }
                  onClick={function () {
                    handleNavClick("orders", "section-orders");
                  }}
                >
                  Order
                </button>
                <button
                  type="button"
                  className={
                    "quick-nav-btn " + (activeNav === "profile" ? "active" : "")
                  }
                  onClick={function () {
                    handleNavClick("profile", "section-profile");
                  }}
                >
                  Profil
                </button>
              </div>

              {/* STATUS ONLINE/OFFLINE */}
              <div id="section-status" style={{ marginBottom: "0.9rem" }}>
                <div className="section-title">Status driver</div>
                <div
                  style={{
                    display: "flex",
                    alignItems: "center",
                    justifyContent: "space-between",
                    gap: "0.8rem",
                    marginTop: "0.4rem",
                    flexWrap: "wrap",
                  }}
                >
                  <div
                    style={{
                      display: "inline-flex",
                      alignItems: "center",
                      gap: "0.5rem",
                      padding: "0.35rem 0.9rem",
                      borderRadius: "999px",
                      background: statusBg,
                      border: "1px solid " + statusColor,
                      color: statusColor,
                      fontSize: "0.8rem",
                      fontWeight: 600,
                    }}
                  >
                    <span
                      style={{
                        width: "8px",
                        height: "8px",
                        borderRadius: "999px",
                        background: statusColor,
                        boxShadow: "0 0 8px " + statusColor,
                      }}
                    ></span>
                    <span>{statusLabel}</span>
                  </div>

                  <button
                    className="btn btn-primary"
                    type="button"
                    onClick={toggleOnlineStatus}
                    style={{ minWidth: "150px" }}
                  >
                    {isOnline ? "Set Offline" : "Mulai Online"}
                  </button>
                </div>
              </div>

              {/* PENDAPATAN & TARGET */}
              <div id="section-income" style={{ marginBottom: "0.9rem" }}>
                <div className="section-title">Pendapatan & target</div>
                <div
                  style={{
                    marginTop: "0.4rem",
                    padding: "0.6rem 0.7rem",
                    borderRadius: "12px",
                    border: "1px solid rgba(148,163,184,0.7)",
                    background: "rgba(15,23,42,0.92)",
                    color: "#e5e7eb",
                    fontSize: "0.8rem",
                  }}
                >
                  <div
                    style={{
                      display: "flex",
                      justifyContent: "space-between",
                      gap: "0.6rem",
                      flexWrap: "wrap",
                    }}
                  >
                    <div>
                      <div style={{ opacity: 0.75, fontSize: "0.72rem" }}>
                        Pendapatan total (fee driver)
                      </div>
                      <div style={{ fontSize: "0.95rem", fontWeight: 700 }}>
                        {formatRupiah(totalIncome)}
                      </div>
                    </div>
                    <div>
                      <div style={{ opacity: 0.75, fontSize: "0.72rem" }}>
                        Target kamu
                      </div>
                      <div style={{ fontSize: "0.95rem", fontWeight: 700 }}>
                        {formatRupiah(targetIncome)}
                      </div>
                    </div>
                  </div>

                  <div className="progress-bar">
                    <div
                      className="progress-fill"
                      style={{ width: progress + "%" }}
                    ></div>
                  </div>
                  <div className="progress-label">
                    Progress: <b>{progress}%</b>{" "}
                    {bonusActive && (
                      <span style={{ color: "#bbf7d0" }}>
                        â€¢ Target tercapai! Bonus estimasi:{" "}
                        {formatRupiah(bonusEstimate)}
                      </span>
                    )}
                  </div>

                  <form
                    onSubmit={handleSaveTarget}
                    style={{
                      marginTop: "0.45rem",
                      display: "flex",
                      gap: "0.35rem",
                      flexWrap: "wrap",
                    }}
                  >
                    <input
                      type="number"
                      min="0"
                      value={targetInput}
                      onChange={function (e) {
                        setTargetInput(e.target.value);
                      }}
                      placeholder="Target (contoh: 200000)"
                      style={{
                        flex: 1,
                        minWidth: "120px",
                        background: "rgba(15,23,42,0.85)",
                        color: "#e5e7eb",
                        borderColor: "rgba(148,163,184,0.9)",
                      }}
                    />
                    <button
                      type="submit"
                      className="btn btn-outline"
                      style={{ paddingInline: "0.8rem" }}
                    >
                      Simpan target
                    </button>
                  </form>
                </div>
              </div>

              {/* ORDER TERSEDIA & ORDER SAYA */}
              <div id="section-orders" style={{ marginBottom: "0.9rem" }}>
                <div
                  style={{
                    display: "flex",
                    alignItems: "center",
                    justifyContent: "space-between",
                    gap: "0.5rem",
                    marginBottom: "0.3rem",
                  }}
                >
                  <div className="section-title">Order tersedia</div>
                  <button
                    type="button"
                    className="btn btn-outline"
                    style={{ padding: "0.3rem 0.7rem", fontSize: "0.75rem" }}
                    onClick={function () {
                      fetchOpenOrders();
                      fetchMyOrders();
                      showMessage("success", "Order diperbarui.");
                    }}
                  >
                    Refresh order
                  </button>
                </div>

                {openOrders.length === 0 ? (
                  <p className="small-text">
                    Belum ada order pending dari customer. Coba buat order dari panel
                    customer lalu tekan tombol <b>Refresh order</b>.
                  </p>
                ) : (
                  <div
                    style={{
                      maxHeight: "160px",
                      overflowY: "auto",
                      borderRadius: "12px",
                      border: "1px solid rgba(148,163,184,0.5)",
                      padding: "0.5rem",
                      background: "rgba(255,255,255,0.6)",
                    }}
                  >
                    {openOrders
                      .slice()
                      .reverse()
                      .map(function (order) {
                        const jenis = order.serviceType || "bike";
                        const tarif = formatRupiah(order.price || 0);
                        const feeDriver = formatRupiah(order.feeDriver || 0);
                        const feeOwner = formatRupiah(order.feeOwner || 0);

                        return (
                          <div
                            key={order.id}
                            style={{
                              padding: "0.55rem 0.6rem",
                              borderRadius: "10px",
                              marginBottom: "0.4rem",
                              background: "rgba(15,23,42,0.9)",
                              color: "#e5e7eb",
                              fontSize: "0.8rem",
                              border: "1px solid rgba(75,85,99,0.7)",
                            }}
                          >
                            <div style={{ fontWeight: 600 }}>
                              [{jenis.toUpperCase()}] {order.pickup} â†’{" "}
                              {order.destination}
                            </div>
                            <div
                              style={{
                                fontSize: "0.72rem",
                                color: "#9ca3af",
                                marginTop: "0.1rem",
                              }}
                            >
                              Customer: {order.customerEmail} â€¢{" "}
                              {new Date(order.createdAt).toLocaleString("id-ID", {
                                day: "2-digit",
                                month: "short",
                                hour: "2-digit",
                                minute: "2-digit",
                              })}
                            </div>
                            <div
                              style={{
                                fontSize: "0.72rem",
                                color: "#bfdbfe",
                                marginTop: "0.2rem",
                              }}
                            >
                              Tarif: <b>{tarif}</b> â€¢ Fee driver:{" "}
                              <b>{feeDriver}</b>
                              <br />
                              <span style={{ opacity: 0.7 }}>
                                Fee aplikator: {feeOwner}
                              </span>
                            </div>
                            <button
                              className="btn btn-primary btn-block"
                              type="button"
                              onClick={function () {
                                handleAcceptOrder(order.id);
                              }}
                              style={{ marginTop: "0.4rem" }}
                            >
                              Ambil Order
                            </button>
                          </div>
                        );
                      })}
                  </div>
                )}

                <div style={{ marginTop: "0.7rem" }}>
                  <div className="section-title">Order saya</div>
                  {myOrders.length === 0 ? (
                    <p className="small-text">
                      Belum ada order yang kamu ambil. Pilih dari daftar "Order
                      tersedia".
                    </p>
                  ) : (
                    <div
                      style={{
                        maxHeight: "160px",
                        overflowY: "auto",
                        borderRadius: "12px",
                        border: "1px solid rgba(148,163,184,0.5)",
                        padding: "0.5rem",
                        background: "rgba(255,255,255,0.6)",
                      }}
                    >
                      {myOrders
                        .slice()
                        .reverse()
                        .map(function (order) {
                          const jenis = order.serviceType || "bike";
                          const tarif = formatRupiah(order.price || 0);
                          const feeDriver = formatRupiah(order.feeDriver || 0);
                          const feeOwner = formatRupiah(order.feeOwner || 0);

                          return (
                            <div
                              key={order.id}
                              style={{
                                padding: "0.55rem 0.6rem",
                                borderRadius: "10px",
                                marginBottom: "0.4rem",
                                background: "rgba(15,23,42,0.9)",
                                color: "#e5e7eb",
                                fontSize: "0.8rem",
                                border: "1px solid rgba(75,85,99,0.7)",
                              }}
                            >
                              <div style={{ fontWeight: 600 }}>
                                [{jenis.toUpperCase()}] {order.pickup} â†’{" "}
                                {order.destination}
                              </div>
                              <div
                                style={{
                                  fontSize: "0.72rem",
                                  color: "#9ca3af",
                                  marginTop: "0.1rem",
                                }}
                              >
                                Status: {order.status} â€¢ Customer:{" "}
                                {order.customerEmail}
                                <br />
                                Dibuat:{" "}
                                {new Date(order.createdAt).toLocaleString("id-ID", {
                                  day: "2-digit",
                                  month: "short",
                                  hour: "2-digit",
                                  minute: "2-digit",
                                })}
                              </div>
                              <div
                                style={{
                                  fontSize: "0.72rem",
                                  color: "#bfdbfe",
                                  marginTop: "0.2rem",
                                }}
                              >
                                Tarif: <b>{tarif}</b> â€¢ Fee driver:{" "}
                                <b>{feeDriver}</b>
                                <br />
                                <span style={{ opacity: 0.7 }}>
                                  Fee aplikator: {feeOwner}
                                </span>
                              </div>
                            </div>
                          );
                        })}
                    </div>
                  )}
                </div>
              </div>

              {/* PROFIL & FOTO DRIVER */}
              <div id="section-profile" style={{ marginBottom: "0.9rem" }}>
                <div className="section-title">Profil & foto driver</div>
                <div
                  style={{
                    display: "flex",
                    gap: "0.7rem",
                    alignItems: "center",
                    marginTop: "0.4rem",
                    flexWrap: "wrap",
                  }}
                >
                  <div className="avatar-wrapper">
                    {photoUrl ? (
                      <img src={photoUrl} alt="Foto driver" className="avatar-img" />
                    ) : (
                      <div className="avatar-placeholder">
                        {profile && profile.name
                          ? profile.name
                              .split(" ")
                              .slice(0, 2)
                              .map((n) => n[0]?.toUpperCase())
                              .join("")
                          : "DX"}
                      </div>
                    )}
                  </div>
                  <div style={{ flex: 1, minWidth: "160px" }}>
                    <p className="small-text">
                      Nama: <b>{profile ? profile.name : "-"}</b>
                      <br />
                      Email: <b>{profile ? profile.email : "-"}</b>
                      <br />
                      Role: <b>{profile ? profile.role : "-"}</b>
                    </p>
                    <form
                      onSubmit={handleSavePhoto}
                      style={{ marginTop: "0.25rem" }}
                    >
                      <input
                        value={photoInput}
                        onChange={function (e) {
                          setPhotoInput(e.target.value);
                        }}
                        placeholder="URL foto (opsional)"
                        style={{ fontSize: "0.78rem" }}
                      />
                      <button
                        type="submit"
                        className="btn btn-outline"
                        style={{
                          marginTop: "0.25rem",
                          padding: "0.35rem 0.7rem",
                          fontSize: "0.75rem",
                        }}
                      >
                        Simpan foto
                      </button>
                    </form>
                  </div>
                </div>
              </div>

              <button className="btn btn-outline btn-block" onClick={handleLogout}>
                Logout
              </button>
            </section>
          );
        }

        if (screen === "landing") return renderLanding();
        if (screen === "register") return renderRegister();
        if (screen === "login") return renderLogin();
        return renderDashboard();
      }

      function AppShell() {
        return (
          <div className="app-root">
            <header className="page-header">
              <div style={{ flex: 1 }}>
                <div className="page-header-title">OjekX Driver</div>
                <div className="page-header-sub">
                  Panel driver â€¢ siap dikembangkan fitur-fitur lanjutan
                </div>
              </div>
              <div className="logo-dot">DX</div>
            </header>

            <main className="page-main">
              <div className="container">
                <DriverApp />
              </div>
            </main>

            <footer>Â© 2025 OjekX â€¢ Driver Panel</footer>
          </div>
        );
      }

      const rootElement = document.getElementById("root");
      const root = ReactDOM.createRoot(rootElement);
      root.render(<AppShell />);
    </script>
  </body>
</html>
